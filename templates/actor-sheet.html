<section class="tams-actor-form flexcol">
    <header class="sheet-header">
        <img class="profile-img" src="{{document.img}}" data-edit="img" title="{{document.name}}" height="100" width="100"/>
        <div class="header-details">
            <h1 class="charname"><input name="name" type="text" value="{{document.name}}" placeholder="Name"/></h1>
            <div class="header-row">
                <div class="physical-notes">
                    <label>Physical Notes</label>
                    <input type="text" name="system.physicalNotes" value="{{system.physicalNotes}}" placeholder="Physical characteristics..."/>
                </div>
            </div>
            <div class="header-row">
                <div class="resource stamina">
                    <label>Stamina</label>
                    <div class="bar-container">
                        <input type="number" name="system.stamina.value" value="{{system.stamina.value}}"/>
                        <div class="bar">
                            <div class="fill" style="width: {{staminaPercentage}}%"></div>
                        </div>
                        <span class="max-label"> / {{system.stamina.max}} </span>
                    </div>
                </div>
                <div class="theme-selector">
                    <label>Theme</label>
                    <select name="system.theme">
                        {{selectOptions themeOptions selected=system.theme localize=true}}
                    </select>
                </div>
            </div>
        </div>
    </header>

    <nav class="sheet-tabs tabs" data-group="primary">
        <a class="item {{#if (eq activeTab 'stats')}}active{{/if}}" data-action="setTab" data-tab="stats">Stats & Limbs</a>
        <a class="item {{#if (eq activeTab 'items')}}active{{/if}}" data-action="setTab" data-tab="items">Weapons & Skills</a>
        <a class="item {{#if (eq activeTab 'abilities')}}active{{/if}}" data-action="setTab" data-tab="abilities">Abilities & Resources</a>
        <a class="item {{#if (eq activeTab 'description')}}active{{/if}}" data-action="setTab" data-tab="description">Traits & Bio</a>
        <a class="item {{#if (eq activeTab 'modifiers')}}active{{/if}}" data-action="setTab" data-tab="modifiers">Modifiers</a>
    </nav>

    <section class="sheet-body">
        {{!-- Stats Tab --}}
        <div class="tab stats {{#if (eq activeTab 'stats')}}active{{/if}}" data-group="primary" data-tab="stats">
            <div class="upgrade-pool flexrow">
                <label>Stat Upgrade Points:</label>
                <input type="number" name="system.upgradePoints.stats" value="{{system.upgradePoints.stats}}"/>
            </div>
            <div class="grid grid-2col">
                <section class="stats-list">
                    {{#each system.stats as |stat id|}}
                    <div class="stat flexrow">
                        <label class="resource-label rollable" data-action="roll" data-roll="stat" data-label="{{localize stat.label}}" data-stat-value="{{stat.value}}">
                            <i class="fas fa-dice-d20"></i> {{localize stat.label}}
                        </label>
                        <input type="number" name="system.stats.{{id}}.value" value="{{stat.value}}" data-dtype="Number"/>
                    </div>
                    {{/each}}
                    <hr>
                    <h3>Special Skills</h3>
                    {{#each system.specialSkills as |skill id|}}
                    <div class="stat flexrow">
                        <label class="resource-label rollable" data-action="roll" data-label="{{capitalize id}}" data-stat-value="{{skill.value}}">
                            <i class="fas fa-dice-d20"></i> {{capitalize id}}
                        </label>
                        <input type="number" name="system.specialSkills.{{id}}.value" value="{{skill.value}}" data-dtype="Number"/>
                    </div>
                    {{/each}}
                </section>

                <section class="limbs-list">
                    <h3>Limbs (HP / Armor)</h3>
                    {{#each system.limbs as |limb id|}}
                    <div class="limb-row flexrow">
                        <label class="resource-label">{{limb.label}}</label>
                        <div class="flexrow limb-values">
                            <input type="number" name="system.limbs.{{id}}.value" value="{{limb.value}}" class="small-input"/>
                            <span>/ {{limb.max}}</span>
                            <small>Arm:</small>
                            <input type="number" name="system.limbs.{{id}}.armor" value="{{limb.armor}}" class="small-input"/>
                        </div>
                    </div>
                    {{/each}}
                </section>
            </div>
        </div>

        {{!-- Items Tab --}}
        <div class="tab items {{#if (eq activeTab 'items')}}active{{/if}}" data-group="primary" data-tab="items">
            <div class="upgrade-pool flexrow">
                <label>Weapon Upgrade Points:</label>
                <input type="number" name="system.upgradePoints.weapons" value="{{system.upgradePoints.weapons}}"/>
                <label>Skill Upgrade Points:</label>
                <input type="number" name="system.upgradePoints.skills" value="{{system.upgradePoints.skills}}"/>
            </div>
            <h3>Weapons <a data-action="itemCreate" data-type="weapon"><i class="fas fa-plus"></i> Add</a></h3>
            <ol class="items-list">
                {{#each weapons as |item id|}}
                <li class="item flexrow" data-item-id="{{item.id}}">
                    <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
                    <h4 class="item-name rollable" data-action="roll" data-item-id="{{item.id}}" data-familiarity="{{item.system.familiarity}}">
                        {{item.name}} (Dmg: {{item.system.calculatedDamage}}) [Fam: {{item.system.familiarity}}]
                    </h4>
                    <div class="item-controls">
                        <a class="item-control" data-action="itemEdit" title="Edit Item"><i class="fas fa-edit"></i></a>
                        <a class="item-control" data-action="itemDelete" title="Delete Item"><i class="fas fa-trash"></i></a>
                    </div>
                </li>
                {{/each}}
            </ol>

            <h3>Skills <a data-action="itemCreate" data-type="skill"><i class="fas fa-plus"></i> Add</a></h3>
            <ol class="items-list">
                {{#each skills as |item id|}}
                <li class="item flexrow" data-item-id="{{item.id}}">
                    <h4 class="item-name rollable" data-action="roll" data-item-id="{{item.id}}" data-familiarity="{{item.system.familiarity}}">
                        {{item.name}} [Fam: {{item.system.familiarity}}]
                    </h4>
                    <div class="item-controls">
                        <a class="item-control" data-action="itemEdit" title="Edit Item"><i class="fas fa-edit"></i></a>
                        <a class="item-control" data-action="itemDelete" title="Delete Item"><i class="fas fa-trash"></i></a>
                    </div>
                </li>
                {{/each}}
            </ol>
        </div>

        {{!-- Abilities & Resources Tab --}}
        <div class="tab abilities {{#if (eq activeTab 'abilities')}}active{{/if}}" data-group="primary" data-tab="abilities">
            <div class="flexrow">
                <h3>Custom Resources</h3>
                <a data-action="resourceAdd"><i class="fas fa-plus"></i> Add Resource</a>
            </div>
            <ol class="resources-list">
                {{#each system.customResources as |res index|}}
                <li class="resource-item flexrow" data-index="{{index}}">
                    <input type="text" name="system.customResources.{{index}}.name" value="{{res.name}}" placeholder="Resource Name"/>
                    <input type="number" name="system.customResources.{{index}}.value" value="{{res.value}}"/>
                    <span> / {{res.max}}</span>
                    <a data-action="resourceDelete" data-index="{{index}}"><i class="fas fa-trash"></i></a>
                </li>
                {{/each}}
            </ol>

            <hr>

            <div class="upgrade-pool flexrow">
                <label>Ability Upgrade Points:</label>
                <input type="number" name="system.upgradePoints.abilities" value="{{system.upgradePoints.abilities}}"/>
            </div>
            <h3>Abilities <a data-action="itemCreate" data-type="ability"><i class="fas fa-plus"></i> Add</a></h3>
            <ol class="items-list">
                {{#each abilities as |item id|}}
                <li class="item flexrow" data-item-id="{{item.id}}">
                    <h4 class="item-name rollable" data-action="roll" data-item-id="{{item.id}}" data-familiarity="{{item.system.familiarity}}">
                        {{item.name}} 
                        {{#if item.system.isAttack}}
                        (Dmg: {{item.system.calculatedDamage}})
                        {{/if}}
                        {{#if item.system.isApex}}
                        (Apex: {{item.system.uses.value}}/{{item.system.uses.max}})
                        {{else}}
                        (Cost: {{item.system.cost}})
                        {{/if}}
                    </h4>
                    <div class="item-controls">
                        <a class="item-control" data-action="itemEdit" title="Edit Item"><i class="fas fa-edit"></i></a>
                        <a class="item-control" data-action="itemDelete" title="Delete Item"><i class="fas fa-trash"></i></a>
                    </div>
                </li>
                {{/each}}
            </ol>
        </div>


        {{!-- Description Tab --}}
        <div class="tab {{#if (eq activeTab 'description')}}active{{/if}}" data-group="primary" data-tab="description">
            <h3>Traits</h3>
            <textarea name="system.traits" rows="5">{{system.traits}}</textarea>
            <hr>
            <h3>Biography</h3>
            <div class="editor-container">
                {{editor enrichedDescription target="system.description" engine="prosemirror" button=true owner=owner editable=editable}}
            </div>
        </div>

        {{!-- Modifiers Tab --}}
        <div class="tab modifiers {{#if (eq activeTab 'modifiers')}}active{{/if}}" data-group="primary" data-tab="modifiers">
            <div class="flexcol">
                <h3>Stamina Modifier</h3>
                <div class="flexrow">
                    <label>Stamina Multiplier</label>
                    <input type="number" name="system.stamina.mult" value="{{system.stamina.mult}}" step="0.25" style="width: 60px;"/>
                </div>
                <hr>
                <h3>Limb Multipliers</h3>
                {{#each system.limbs as |limb id|}}
                <div class="flexrow">
                    <label style="flex:1">{{limb.label}}</label>
                    <small>Mult:</small>
                    <input type="number" name="system.limbs.{{id}}.mult" value="{{limb.mult}}" step="0.25" style="width:60px;"/>
                </div>
                {{/each}}
                <hr>
                <h3>Resource Modifiers</h3>
                {{#each system.customResources as |res index|}}
                <div class="flexrow" data-index="{{index}}">
                    <label style="flex:1">{{res.name}}</label>
                    <select name="system.customResources.{{index}}.stat" style="width:110px;">
                        {{selectOptions ../statOptions selected=res.stat localize=true}}
                    </select>
                    <small>x</small>
                    <input type="number" name="system.customResources.{{index}}.mult" value="{{res.mult}}" step="0.25" style="width: 60px;"/>
                    <small>+</small>
                    <input type="number" name="system.customResources.{{index}}.bonus" value="{{res.bonus}}" style="width: 60px;"/>
                </div>
                {{/each}}
            </div>
        </div>
    </section>
</section>
