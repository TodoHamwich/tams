<section class="tams-item-form flexcol">
    <header class="sheet-header">
        <div class="profile-img-container" data-action="editImage" data-edit="img">
            <img src="{{document.img}}" title="{{document.name}}" height="64" width="64"/>
            <input type="hidden" name="img" value="{{document.img}}"/>
            <div class="image-edit-overlay small">
                <i class="fas fa-edit"></i>
            </div>
        </div>
        <h1 class="charname"><input name="name" type="text" value="{{document.name}}" placeholder="Name"/></h1>
    </header>

    <section class="sheet-body">
        <div class="flexcol">
            {{!-- Common Physical Fields --}}
            {{#if (or (eq item.type 'weapon') (eq item.type 'equipment') (eq item.type 'armor') (eq item.type 'consumable') (eq item.type 'tool') (eq item.type 'questItem') (eq item.type 'backpack'))}}
            <div class="flexrow">
                <label>Quantity</label>
                <input type="number" name="system.quantity" value="{{system.quantity}}"/>
                <label>Size</label>
                <select name="system.size">
                    {{selectOptions sizeOptions selected=system.size}}
                </select>
                <label>Location</label>
                <select name="system.location">
                    {{selectOptions locationOptions selected=system.location}}
                </select>
            </div>
            <hr>
            {{/if}}

            <div class="flexrow">
                <label>Familiarity</label>
                <input type="number" name="system.familiarity" value="{{system.familiarity}}" data-dtype="Number"/>
            </div>

            {{#if (eq item.type "weapon")}}
            <div class="flexrow">
                <label>Equipped?</label>
                <input type="checkbox" name="system.equipped" {{checked system.equipped}}/>
            </div>
            <div class="flexrow">
                <label>Fire Rate</label>
                <select name="system.fireRate">
                    <option value="1" {{#if (eq system.fireRate "1")}}selected{{/if}}>Single (1)</option>
                    <option value="3" {{#if (eq system.fireRate "3")}}selected{{/if}}>Burst (3)</option>
                    <option value="auto" {{#if (eq system.fireRate "auto")}}selected{{/if}}>Full Auto (10)</option>
                    <option value="custom" {{#if (eq system.fireRate "custom")}}selected{{/if}}>Custom</option>
                </select>
                {{#if (eq system.fireRate 'custom')}}
                <input type="number" name="system.fireRateCustom" value="{{system.fireRateCustom}}" style="width: 50px;"/>
                {{/if}}
            </div>
            <div class="flexrow">
                {{#unless system.isRanged}}
                <label>Heavy?</label>
                <input type="checkbox" name="system.isHeavy" {{checked system.isHeavy}}/>
                <label>Two Handed?</label>
                <input type="checkbox" name="system.isTwoHanded" {{checked system.isTwoHanded}}/>
                {{/unless}}
                <label>Light?</label>
                <input type="checkbox" name="system.isLight" {{checked system.isLight}}/>
            </div>
            <div class="flexrow">
                <label>Ranged?</label>
                <input type="checkbox" name="system.isRanged" {{checked system.isRanged}}/>
                {{#if system.isRanged}}
                <label>Thrown?</label>
                <input type="checkbox" name="system.isThrown" {{checked system.isThrown}}/>
                {{/if}}
            </div>
            {{#if system.isRanged}}
            <div class="flexrow">
                <label>Ranged Damage</label>
                <input type="number" name="system.rangedDamage" value="{{system.rangedDamage}}" data-dtype="Number"/>
            </div>
            <div class="flexrow">
                <label>Ammo</label>
                <input type="number" name="system.ammo.current" value="{{system.ammo.current}}" data-dtype="Number"/>
                <span> / </span>
                <input type="number" name="system.ammo.total" value="{{system.ammo.total}}" data-dtype="Number"/>
            </div>
            {{/if}}
            <div class="flexrow">
                <label>Calculated Damage</label>
                <span>{{system.calculatedDamage}}</span>
            </div>
            <div class="flexrow">
                <label>Armour Penetration?</label>
                <input type="checkbox" name="system.hasArmourPen" {{checked system.hasArmourPen}}/>
                {{#if system.hasArmourPen}}
                <label>Value</label>
                <input type="number" name="system.armourPenetration" value="{{system.armourPenetration}}"/>
                {{/if}}
            </div>
            <div class="flexrow">
                <label>AoE Attack?</label>
                <input type="checkbox" name="system.isAoE" {{checked system.isAoE}}/>
            </div>
            <div class="flexrow">
                <label>Special</label>
                <input type="text" name="system.special" value="{{system.special}}"/>
            </div>
            {{/if}}

            {{#if (eq item.type "armor")}}
            <div class="flexrow">
                <label>Equipped?</label>
                <input type="checkbox" name="system.equipped" {{checked system.equipped}}/>
            </div>
            <h4 style="border-bottom: 1px solid #7a7971; margin-top: 10px;">Limb Protection</h4>
            <div class="grid grid-2col">
                {{#each system.limbs as |limb id|}}
                <div class="flexcol" style="border: 1px solid #ccc; padding: 3px; margin: 2px;">
                    <label><b>{{capitalize id}}</b></label>
                    <div class="flexrow">
                        <span>Val:</span><input type="number" name="system.limbs.{{id}}.value" value="{{limb.value}}"/>
                        <span>Max:</span><input type="number" name="system.limbs.{{id}}.max" value="{{limb.max}}"/>
                    </div>
                </div>
                {{/each}}
            </div>
            {{/if}}

            {{#if (eq item.type "backpack")}}
            <div class="flexrow">
                <label>Equipped?</label>
                <input type="checkbox" name="system.equipped" {{checked system.equipped}}/>
            </div>
            <div class="flexrow">
                <label title="How much extra capacity this backpack adds, in Medium Item units (10 Small = 1 Medium).">Capacity (Medium Items)</label>
                <input type="number" name="system.capacity" value="{{system.capacity}}"/>
            </div>
            <div class="flexrow">
                <label title="Multiplier applied to items placed inside this backpack. 0.5 halves their effective size.">Carrying Modifier</label>
                <input type="number" name="system.modifier" value="{{system.modifier}}" step="0.1"/>
            </div>
            <p class="notes" style="font-size: 0.85em; color: #666; font-style: italic; margin-top: 5px; border-left: 3px solid #7a7971; padding-left: 5px;">
                <b>Carrying Modifier:</b> This multiplier is applied to the size of items placed in the 'Backpack' location. For example, 0.5 means items only take up 50% of their normal size units.
            </p>
            <h4 style="border-bottom: 1px solid #7a7971; margin-top: 10px;">Penalties</h4>
            <div class="flexrow">
                <label>Active?</label>
                <input type="checkbox" name="system.penalties.active" {{checked system.penalties.active}}/>
            </div>
            {{#if system.penalties.active}}
            <div class="grid grid-2col">
                <div class="flexrow"><label>Strength</label><input type="number" name="system.penalties.strength" value="{{system.penalties.strength}}"/></div>
                <div class="flexrow"><label>Dexterity</label><input type="number" name="system.penalties.dexterity" value="{{system.penalties.dexterity}}"/></div>
                <div class="flexrow"><label>Dodge</label><input type="number" name="system.penalties.dodge" value="{{system.penalties.dodge}}"/></div>
                <div class="flexrow"><label>Attack</label><input type="number" name="system.penalties.attack" value="{{system.penalties.attack}}"/></div>
                <div class="flexrow"><label>Movement</label><input type="number" name="system.penalties.movement" value="{{system.penalties.movement}}"/></div>
            </div>
            {{/if}}
            {{/if}}

            {{#if (eq item.type "consumable")}}
            <div class="flexrow">
                <label>Uses</label>
                <input type="number" name="system.uses.value" value="{{system.uses.value}}"/>
                <span> / </span>
                <input type="number" name="system.uses.max" value="{{system.uses.max}}"/>
            </div>
            {{/if}}

            {{#if (or (eq item.type "equipment") (eq item.type "tool") (eq item.type "questItem") (eq item.type "consumable") (eq item.type "armor") (eq item.type "backpack"))}}
            <div class="flexrow">
                <label>Tags</label>
                <input type="text" name="system.tags" value="{{system.tags}}"/>
            </div>
            {{/if}}

            {{#if (or (eq item.type "skill") (eq item.type "ability"))}}
            <div class="flexrow">
                <label>Upgrade Points</label>
                <input type="number" name="system.upgradePoints" value="{{system.upgradePoints}}" data-dtype="Number"/>
            </div>
            {{#if (eq item.type "skill")}}
            <div class="flexrow">
                <label>Linked Stat</label>
                <select name="system.stat">
                    {{selectOptions statOptions selected=system.stat localize=true}}
                </select>
            </div>
            {{/if}}
            <div class="flexrow">
                <label>Tags</label>
                <input type="text" name="system.tags" value="{{system.tags}}"/>
            </div>
            {{/if}}

            {{#if (eq item.type "ability")}}
            <div class="flexrow">
                <label>Apex Ability?</label>
                <input type="checkbox" name="system.isApex" {{checked system.isApex}}/>
                <label>Is Reaction?</label>
                <input type="checkbox" name="system.isReaction" {{checked system.isReaction}}/>
            </div>
            <div class="flexrow">
                <label>Bonus</label>
                <input type="number" name="system.bonus" value="{{system.bonus}}" data-dtype="Number"/>
            </div>
            <div class="flexrow">
                <label>Uses</label>
                <input type="number" name="system.uses.value" value="{{system.uses.value}}"/>
                <span> / </span>
                <input type="number" name="system.uses.max" value="{{system.uses.max}}"/>
            </div>
            {{#unless system.isApex}}
            <div class="flexrow">
                <label>Cost</label>
                <input type="number" name="system.cost" value="{{system.cost}}" {{#if system.calculator.enabled}}disabled="disabled"{{/if}}/>
            </div>
            <div class="flexrow">
                <label>Resource</label>
                <select name="system.resource">
                    {{selectOptions resourceOptions selected=system.resource}}
                </select>
            </div>
            {{/unless}}

            <div class="calculator-toggle flexrow">
                <label>Use Cost Calculator?</label>
                <input type="checkbox" name="system.calculator.enabled" {{checked system.calculator.enabled}}/>
            </div>

            {{#if system.calculator.enabled}}
            <section class="cost-calculator" style="border: 1px solid #7a7971; padding: 5px; margin-top: 5px; font-size: 0.9em;">
                <h4 style="margin: 0 0 5px 0; border-bottom: 1px solid #7a7971;">Cost Calculator</h4>
                
                <div class="flexrow">
                    <label>Is Utility? (Different Math)</label>
                    <input type="checkbox" name="system.calculator.isUtility" {{checked system.calculator.isUtility}}/>
                </div>

                <div class="flexrow" title="Each effect adds +1 cost.">
                    <label>Base Effects Count</label>
                    <input type="number" name="system.calculator.effects" value="{{system.calculator.effects}}"/>
                </div>
                <div class="flexrow" title="Guaranteed Max adds +2 instead of +1.">
                    <label>Guaranteed Max Effects</label>
                    <input type="number" name="system.calculator.guaranteedMax" value="{{system.calculator.guaranteedMax}}"/>
                </div>
                <div class="flexrow" title="Detriments lower cost by -1 (Min cost 1).">
                    <label>Detriments Count</label>
                    <input type="number" name="system.calculator.detriments" value="{{system.calculator.detriments}}"/>
                </div>

                <div class="flexcol" style="background: rgba(0,0,0,0.05); padding: 3px; margin: 3px 0;">
                    <div class="flexrow">
                        <label>Double Own Movement (+2)</label>
                        <input type="checkbox" name="system.calculator.movementDoubleOwn" {{checked system.calculator.movementDoubleOwn}}/>
                    </div>
                    <div class="flexrow">
                        <label>Halve Enemy Movement (+4)</label>
                        <input type="checkbox" name="system.calculator.movementHalveEnemy" {{checked system.calculator.movementHalveEnemy}}/>
                    </div>
                    <div class="flexrow">
                        <label>Flat Movement Change (+2 per m)</label>
                        <input type="number" name="system.calculator.movementFlat" value="{{system.calculator.movementFlat}}"/>
                    </div>
                </div>

                <div class="flexrow">
                    <label>Roll Plus (+1 per +5)</label>
                    <input type="number" name="system.calculator.rollBonus" value="{{system.calculator.rollBonus}}"/>
                </div>
                <div class="flexrow">
                    <label>Ignore Armor (+1 per 5)</label>
                    <input type="number" name="system.calculator.ignoreArmor" value="{{system.calculator.ignoreArmor}}"/>
                </div>

                <div class="flexrow">
                    <label>Target Body Part</label>
                    <select name="system.calculator.bodyPart">
                        {{selectOptions calculatorOptions.bodyParts selected=system.calculator.bodyPart}}
                    </select>
                </div>

                {{#if (not (eq system.calculator.bodyPart "none"))}}
                <div class="flexrow">
                    <label>Targeted Limb</label>
                    <select name="system.calculator.targetLimb">
                        {{selectOptions limbOptions selected=system.calculator.targetLimb}}
                    </select>
                </div>
                {{/if}}

                <div class="flexrow">
                    <label>Fire Rate</label>
                    <select name="system.calculator.fireRate">
                        {{selectOptions calculatorOptions.fireRates selected=system.calculator.fireRate}}
                    </select>
                </div>

                <div class="flexrow">
                    <label>Add. Multi-Attack Hits (+2 each)</label>
                    <input type="number" name="system.calculator.multiAttackHits" value="{{system.calculator.multiAttackHits}}"/>
                </div>

                <div class="flexrow">
                    <label>Damage from Stat</label>
                    <select name="system.calculator.damageStatFraction">
                        {{selectOptions calculatorOptions.damageFractions selected=system.calculator.damageStatFraction}}
                    </select>
                </div>

                <div class="flexrow">
                    <label>Stun / Activation Loss</label>
                    <select name="system.calculator.stun">
                        {{selectOptions calculatorOptions.stunOptions selected=system.calculator.stun}}
                    </select>
                </div>

                <div class="flexrow">
                    <label>Healing Amount (+1 per 5hp)</label>
                    <input type="number" name="system.calculator.healing" value="{{system.calculator.healing}}"/>
                </div>

                <div class="flexcol" style="background: rgba(0,0,0,0.05); padding: 3px; margin: 3px 0;">
                    <div class="flexrow">
                        <label>Damage Reduction Type</label>
                        <select name="system.calculator.drType">
                            {{selectOptions calculatorOptions.drTypes selected=system.calculator.drType}}
                        </select>
                    </div>
                    <div class="flexrow">
                        <label>DR Amount</label>
                        <input type="number" name="system.calculator.drValue" value="{{system.calculator.drValue}}"/>
                    </div>
                </div>

                <div class="flexrow">
                    <label>Bypass Dodge (x2)</label>
                    <input type="checkbox" name="system.calculator.bypassDodge" {{checked system.calculator.bypassDodge}}/>
                    <label>Bypass Retal (x2)</label>
                    <input type="checkbox" name="system.calculator.bypassRetaliation" {{checked system.calculator.bypassRetaliation}}/>
                </div>

                <div class="flexrow">
                    <label>Target(s)</label>
                    <select name="system.calculator.targetType">
                        {{selectOptions calculatorOptions.targetTypes selected=system.calculator.targetType}}
                    </select>
                </div>

                <div class="flexrow">
                    <label>AoE Radius (m)</label>
                    <input type="number" name="system.calculator.aoeRadius" value="{{system.calculator.aoeRadius}}"/>
                </div>

                <div class="flexrow">
                    <label>Max Range (m)</label>
                    <input type="number" name="system.calculator.range" value="{{system.calculator.range}}"/>
                </div>

                <div class="flexrow">
                    <label>Duration</label>
                    <select name="system.calculator.duration">
                        {{selectOptions calculatorOptions.durations selected=system.calculator.duration}}
                    </select>
                </div>

                <div class="flexrow">
                    <label>Stackable with self? (x2)</label>
                    <input type="checkbox" name="system.calculator.isStackable" {{checked system.calculator.isStackable}}/>
                </div>

                <div class="flexrow" style="font-weight: bold; border-top: 1px solid #7a7971; margin-top: 5px;">
                    <label>Calculated Cost:</label>
                    <span>{{system.calculatedCost}}</span>
                </div>
            </section>
            {{/if}}

            <div class="flexrow">
                <label>Multi-Attack</label>
                <input type="number" name="system.multiAttack" value="{{system.multiAttack}}"/>
                <label>AoE Attack?</label>
                <input type="checkbox" name="system.isAoE" {{checked system.isAoE}}/>
            </div>
            <hr>
            <div class="flexrow">
                <label>Is Attack?</label>
                <input type="checkbox" name="system.isAttack" {{checked system.isAttack}}/>
            </div>
            {{#if system.isAttack}}
            <div class="flexcol" style="border: 1px solid #7a7971; padding: 5px; margin-top: 5px;">
                <div class="flexrow">
                    <label>{{#if (eq system.damageStat "custom")}}Custom Damage{{else}}Base Damage{{/if}}</label>
                    <input type="number" name="system.damage" value="{{system.damage}}" data-dtype="Number"/>
                </div>
                <div class="flexrow">
                    <label>Armour Penetration</label>
                    <input type="number" name="system.armourPenetration" value="{{system.armourPenetration}}"/>
                </div>
                <div class="flexrow">
                    <label>Attack Stat</label>
                    <select name="system.attackStat">
                        {{selectOptions statOptions selected=system.attackStat localize=true}}
                    </select>
                </div>
                <div class="flexrow">
                    <label>Damage Stat</label>
                    <select name="system.damageStat">
                        {{selectOptions statOptions selected=system.damageStat localize=true}}
                    </select>
                </div>
                {{#unless (eq system.damageStat "custom")}}
                <div class="flexrow">
                    <label>Damage Multiplier</label>
                    <input type="number" name="system.damageMult" value="{{system.damageMult}}" step="0.05"/>
                </div>
                {{/unless}}
                <div class="flexrow">
                    <label>Damage Bonus</label>
                    <input type="number" name="system.damageBonus" value="{{system.damageBonus}}"/>
                </div>
                <div class="flexrow">
                    <label>Calculated Damage</label>
                    <span>{{system.calculatedDamage}}</span>
                </div>
            </div>
            {{/if}}
            {{#unless system.isAttack}}
            <div class="flexrow">
                <label>Stat Cap</label>
                <select name="system.capStat">
                    {{selectOptions statOptionsNoCustom selected=system.capStat localize=true}}
                </select>
            </div>
            {{/unless}}
            {{/if}}

            <hr>
            <label>Description</label>
            <textarea name="system.description" rows="10">{{system.description}}</textarea>
        </div>
    </section>
</section>
